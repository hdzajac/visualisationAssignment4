<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}

text {
  font-family: sans-serif;
  font-size: 10px;
}
#mapid { 
  position: absolute;
   top: 0;
   right: 0;
   bottom: 0;
   left: 0;
}

</style>

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
    integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
    crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
    integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
    crossorigin=""></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"> </script>
<script src = "https://d3js.org/d3-request.v1.min.js"></script>


</head>
<body >
  <div id="mapid"></div>
  <script >
	var airports = {}; 
	var danishAirportsCoord = {}
	var danishAirportsRoutes = {}
	
	function Graph()
	{
		this.adjList = {}
	}
	
	Graph.prototype.addVertex = function(vertex)
	{
		this.adjList[vertex] = []
	}
	
	Graph.prototype.addEdge = function(v1, v2)
	{	
		this.adjList[v1].push(v2)
	}
	
	Graph.prototype.vertexExists = function(v1)
	{	
		return v1 in this.adjList
	}
	
	Graph.prototype.getAdjList = function()
	{	
		return this.adjList
	}
	
	
	
	function getAirports(map)
	{
	 d3.csv("airports.csv", function(data) 
	 {
			var graph = new Graph()
			for (var i = 0; i < data.length; i++) 
			{							
				var airport = data[i]
				airports[airport.Code] = [ data[i].Latitude,  data[i].Longitude]	
				if (airport.Country == "Denmark")
				{
					danishAirportsCoord[airport.Code] = [ data[i].Latitude,  data[i].Longitude]
					graph.addVertex(airport.Code)	
				}
				
			}	
			
			addMarkers(danishAirportsCoord, map)	
						
			d3.csv("routes.csv", function(routes) 
			{			
				for (var i = 0; i < routes.length; i++) 
				{
					var route = routes[i]					
					if (route.Source in danishAirportsCoord)	// from Dk					
					{
						graph.addEdge(route.Source, route.Destination)
						if(graph.vertexExists(route.Destination) == false)
						{
							graph.addVertex(route.Destination)
						}
					}	

					if (route.Destination in danishAirportsCoord)	// to DK					
					{
						//if(graph.vertexExists(route.Source))
						//	graph.addEdge(route.Source, route.Destination)
					}	
				}
				
				console.log("Graph:", graph)
				addLines(airports, graph, map)
			});
				
		});
		

	}

	
	function addLines(airports, graph, map)
	{		
		var adjList = graph.getAdjList()
		var nodes = Object.keys(adjList)
		for (var i = 0; i < nodes.length; i++) 
		{
			var neighbors = adjList[nodes[i]]
			for (var j = 0; j <neighbors.length; j++) 
			{
				
				var latlonS = [parseFloat(airports[nodes[i]][0]), parseFloat(airports[nodes[i]][1])]
				var latlonD = [parseFloat(airports[neighbors[j]][0]), parseFloat(airports[neighbors[j]][1])]
				var points = [latlonS, latlonD]
				console.log(points)
				var polyline = L.polyline(points).addTo(map);
			}
			
		}
		console.log("count:", count)
	}
	
	function addMarkers(data, map){
		for (var key in data) {
			var lat = parseFloat(data[key][0])
			var lg = parseFloat(data[key][1])
			//var marker = L.marker([lat, lg]).addTo(mymap);
			var circle = L.circle([lat, lg], {
			  color: 'red',
			  fillColor: '#f03',
			  fillOpacity: 0.5,
			  radius: 500
		  }).addTo(mymap);
		}
		
	}
	
  
      var mymap = L.map('mapid').setView([55.605, 13], 7);
      
      
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'sk.eyJ1IjoicmlhLWFuZHJlZWEiLCJhIjoiY2pwbHEweWE3MDR1MTQzcXVuY25mbmtjaSJ9.hw5_KcxgcC_qFwrAwhbmqw'
      }).addTo(mymap);


      getAirports(mymap)
	  
      var circle = L.circle([51.508, -0.11], {
          color: 'red',
          fillColor: '#f03',
          fillOpacity: 0.5,
          radius: 500
      }).addTo(mymap);
      
      // var svg = d3.select("svg"),
      //     width = +svg.attr("width"),
      //     height = +svg.attr("height");
      
      // var color = d3.scaleOrdinal(d3.schemeCategory20);
      
      // var simulation = d3.forceSimulation()
      //     .force("link", d3.forceLink().id(function(d) { return d.id; }))
      //     .force("charge", d3.forceManyBody())
      //     .force("center", d3.forceCenter(width / 2, height / 2));
      
      // d3.json("miserables.json", function(error, graph) {
      //   if (error) throw error;
      
      //   var link = svg.append("g")
      //       .attr("class", "links")
      //     .selectAll("line")
      //     .data(graph.links)
      //     .enter().append("line")
      //       .attr("stroke-width", function(d) { return Math.sqrt(d.value); });
      
      //   var node = svg.append("g")
      //       .attr("class", "nodes")
      //     .selectAll("g")
      //     .data(graph.nodes)
      //     .enter().append("g")
          
      //   var circles = node.append("circle")
      //       .attr("r", 5)
      //       .attr("fill", function(d) { return color(d.group); })
      //       .call(d3.drag()
      //           .on("start", dragstarted)
      //           .on("drag", dragged)
      //           .on("end", dragended));
      
      //   var lables = node.append("text")
      //       .text(function(d) {
      //         return d.id;
      //       })
      //       .attr('x', 6)
      //       .attr('y', 3);
      
      //   node.append("title")
      //       .text(function(d) { return d.id; });
      
      //   simulation
      //       .nodes(graph.nodes)
      //       .on("tick", ticked);
      
      //   simulation.force("link")
      //       .links(graph.links);
      
      //   function ticked() {
      //     link
      //         .attr("x1", function(d) { return d.source.x; })
      //         .attr("y1", function(d) { return d.source.y; })
      //         .attr("x2", function(d) { return d.target.x; })
      //         .attr("y2", function(d) { return d.target.y; });
      
      //     node
      //         .attr("transform", function(d) {
      //           return "translate(" + d.x + "," + d.y + ")";
      //         })
      //   }
      // });
      
      // function dragstarted(d) {
      //   if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      //   d.fx = d.x;
      //   d.fy = d.y;
      // }
      
      // function dragged(d) {
      //   d.fx = d3.event.x;
      //   d.fy = d3.event.y;
      // }
      
      // function dragended(d) {
      //   if (!d3.event.active) simulation.alphaTarget(0);
      //   d.fx = null;
      //   d.fy = null;
      // }
      
      </script>
</body>